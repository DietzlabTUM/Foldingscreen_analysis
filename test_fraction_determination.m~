%%
close all, clear all, clc
s = '/Users/jonasfunke/Dropbox (DIETZ LAB)/FOLDINGSCREENS/AM_Monomer_v1/AM_Monomer_v1_data.mat';
load(s)

profileData = analyze_gel_fractions(profileData, gelData);
%%
profileData = compute_exp_parameter(profileData, 1.5);



%%
    figure(2)
    subplot(4, 1, 1)
    height_width = zeros(length(profileData.profiles),1);
    for i=1:length(profileData.profiles)
        height_width(i) = profileData.monomerFits{i}.a1/profileData.monomerFits{i}.c1;
    end
    plot(height_width, '.-')
    xlabel('Lane')
    ylabel('Height/width')
    set(gca, 'XTick', [1:length(profileData.profiles) ] )

    subplot(4,1,2)
    plot(profileData.monomerTotal, '.-')
    xlabel('Lane')
    ylabel('monomer absolute')
    set(gca, 'XTick', [1:length(profileData.profiles) ] )

    subplot(4,1,3)
    plot(profileData.monomerTotal./(profileData.monomerTotal+profileData.pocketTotal+profileData.smearTotal), '.-')
    xlabel('Lane')
    ylabel('monomer/(monomer+pocket+smear)')
     set(gca, 'XTick', [1:length(profileData.profiles) ] )

    subplot(4,1,4)
    mig_distance = zeros(length(profileData.profiles),1);
    for i=1:length(profileData.profiles)
        mig_distance(i) = profileData.monomerFits{i}.b1-profileData.aggregateFit.b1;
    end
    plot(mig_distance, '.-')
    xlabel('Lane')
    ylabel('Migration distance (pocket to monomer) [px]')
    set(gca, 'XTick', [1:length(profileData.profiles) ] )
    
    
    
    %%
    
    height_width = zeros(length(profileData.profiles),1);
    for i=1:length(profileData.profiles)
        height_width(i) = profileData.monomerFits{i}.a1/profileData.monomerFits{i}.c1;
    end
    
    % T-screen indices
    for i=1:length(gelInfo.lanes)
        cur_name = strtrim(gelInfo.lanes{i});
        if strcmpi(cur_name(1), 'T')
            index_Tscrn(str2num(cur_name(2))) = i;
        end
    end
    % Mg-screen indices
    for i=1:length(gelInfo.lanes)
        cur_name = strtrim(gelInfo.lanes{i});
        if strcmpi(cur_name, 'M5')
            index_Mgscrn(1) = i;
        end
        if strcmpi(cur_name, 'M10')
            index_Mgscrn(2) = i;
        end
        if strcmpi(cur_name, 'M15')
            index_Mgscrn(3) = i;
        end
        if strcmpi(cur_name, 'M20')
            index_Mgscrn(4) = i;
        end
        if strcmpi(cur_name, 'M25')
            index_Mgscrn(5) = i;
        end
        if strcmpi(cur_name, 'M30')
            index_Mgscrn(6) = i;
        end
    end
            
    % RM indices
    for i=1:length(gelInfo.lanes)
        cur_name = strtrim(gelInfo.lanes{i});
        if strcmpi(cur_name, 'RM1')
            index_RM(1) = i;
        end
        if strcmpi(cur_name, 'RM1_diluted')
            index_RM(1) = i;
        end
        if strcmpi(cur_name, 'RM2')
            index_RM(2) = i;
        end
    end 
    % all indices except for scaffold and ladder
    index_foldings = [];
    for i=1:length(gelInfo.lanes)
        cur_name = strtrim(gelInfo.lanes{i});
        if ~strcmpi(cur_name, 'scaffold')
            index_foldings = [index_foldings, i];
        else
            if ~strcmpi(cur_name, '1kb_ladder')
            index_foldings = [index_foldings, i];
        end
    end 
    
   % get_ranking(height_width(index_Tscrn))
   % get_ranking(height_width(index_Mgscrn))
   % get_ranking(height_width(index_RM))
   % get_ranking(height_width([index_Tscrn index_Mgscrn index_RM]))

    get_ranking(height_width(index_foldings))

%%
close all, clear all, clc
s = '/Users/jonasfunke/Dropbox (DIETZ LAB)/FOLDINGSCREENS/CS_T1v1/CS_T1v1_data.mat';
load(s)

analyze_gel_fractions(profileData, gelData)

%%










%%
%s = '/Users/jonasfunke/Dropbox (DIETZ LAB)/FOLDINGSCREENS/CS_T1v1/CS_T1v1_data.mat';

%t = '/Users/jonasfunke/Dropbox (DIETZ LAB)/FOLDINGSCREENS/CS_T1v1/170117_T3DI_folding_screen_300V-[EtBr].tif';
%%


%%
close all
i = 10;

plot( fliplr(profileData.profiles{i}')), hold on

plot(cumsum(fliplr(profileData.profiles{i}')))


%%


close all

for i=1:length(profileData.profiles)

    %min_peak_height = median(profileData.profiles{i});
    n_peaks = 0;
    p_start = 0.000001;
    while n_peaks~=1
     
        min_peak_height = 0.005*sum(profileData.profiles{i}(100:end));
        findpeaks(profileData.profiles{i}(100:end), 'MinPeakHeight', min_peak_height, 'MinPeakWidth', 1)
      
        
    end
    pause
end
%%

%%

plot_image_ui(gelData.images{1});
h = imrect;

wait(h);
selectedArea = int32(getPosition(h));


close all

%%
fits = cell(length(profileData.profiles),1);
tmp = zeros(2, length(profileData.profiles));
for i=1:length(profileData.profiles)
    %subplot(length(profileData.profiles), 1, i)
    figure
    
    tmp(i,:) = max(profileData.fullProfiles{i}(selectedArea(2):selectedArea(2)+selectedArea(4)));
    
    y = profileData.fullProfiles{i}(selectedArea(2):selectedArea(2)+selectedArea(4));
    x = double(selectedArea(2):selectedArea(2)+selectedArea(4));
    
    fits{i} = fit(x', y, 'gauss1');
    plot(x, profileData.fullProfiles{i}(selectedArea(2):selectedArea(2)+selectedArea(4))), hold on

    plot(x, fit_val(x))
    
    
end
%%

subplot(4, 1, 1)
tmp = zeros(length(profileData.profiles),1);
for i=1:length(profileData.profiles)
    tmp(i) = fits{i}.a1;
end
plot(tmp)

subplot(4, 1, 2)
tmp = zeros(length(profileData.profiles),1);
for i=1:length(profileData.profiles)
    tmp(i) = fits{i}.c1;
end
plot(tmp)

subplot(4, 1, 3)
tmp = zeros(length(profileData.profiles),1);
for i=1:length(profileData.profiles)
    tmp(i) = fits{i}.b1;
end
plot(tmp)
%%
subplot(4, 1, 4)
tmp = zeros(length(profileData.profiles),1);
for i=1:length(profileData.profiles)
    tmp(i) = fits{i}.a1/fits{i}.c1;
end
plot(tmp)
%%





